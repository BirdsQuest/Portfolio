<?php if(isset($_POST["plainText"])){header('Content-Type: text/plain; charset=utf-8');}$baseURL="https://randomcode.run";$SITENAME="randomcode.run";$admin=2;$loginTimeout=30;$response="";$fbAppID="812492792239131";$fbSecret="fee6793d2b313651a17c440fd8c5cf44";$recaptchaSecret="6LdAeyQUAAAAAOB5Tw-589QibPzi1S6BXgi0pD7l";$gtag="UA-127317507-1";$text=array();$language="en";$DBHOST="localhost";$DBUSER="randetja_birdman";$DBPASS="wGNYewDjz9fwncu8e";$D="d";$E="e";$I="i";$SHOW=array("d"=>true,"e"=>true,"i"=>true);$META=0;$OBJECT=1;$FIELD=2;$ARRAY=3;$SUBARRAY=4;$SUB2ARRAY=5;$SUB3ARRAY=6;$SPLIT=array("~&","~`","~!","~@","~$","~%","~^");class php{public static $messages=array();public static $responses=array();public static function printArr($array,$name){foreach($array as $key=>$value){message::I($name."[".$key."]=".$value);}}public static function getIP(){return!filter_var(@$_SERVER["HTTP_CLIENT_IP"],FILTER_VALIDATE_IP)?(!filter_var(@$_SERVER["HTTP_X_FORWARDED_FOR"],FILTER_VALIDATE_IP)?$_SERVER["REMOTE_ADDR"]:$_SERVER["HTTP_X_FORWARDED_FOR"]):$_SERVER["HTTP_CLIENT_IP"];}public static function setLanguage($newLang){global $language,$text;if($language!=$newLang){$toFetch=array();foreach($text as $key=>$value){array_push($toFetch,$key);}$text=tGet(implode(",",$toFetch));$language=$newLang;}}public static function tBase(){$countryCode=@json_decode(file_get_contents("http://www.geoplugin.net/json.gp?ip=".getIP()))->geoplugin_countryCode;switch($countryCode){case "jp":return "jp";}return "en";}public static function tGet($fields){global $language,$text;DB::tempTable("TEXT");$fields=explode(",",$fields);$new=DB::selectFields(array("name"=>$fields),$language);for($index=0;$index<count($text);$index++){$text[$fields[$index]]=$new[$index];}DB::restoreTable();}public static function errorCode($code,$message){respond($code);if($message!=null){error($message);}PHP();}public static function setErrorHandler(){set_exception_handler("php::exception");}public static function exception(){php::printError("Exception");}public static function shutdown(){php::printError("Shutdown");}public static function printError($message){message::e($message);PHP();}public static function out(){global $response,$META,$OBJECT;if(sizeof(php::$messages)>0){$joiner=message::$interrupted?"~`":chr(7);$response=collapse($META,array($joiner.collapse($OBJECT,php::$messages),$response));}else if(message::$interrupted){echo "~&";}echo $response;ob_flush();exit();}static public function caller($msg){$bt=debug_backtrace();$caller=array_shift($bt);$caller=array_shift($bt);echo $caller['file'];echo $caller['line'];}}function hasKey($arr,$key){return isset($arr[$key])||array_key_exists($key,$arr);}class message{public static $interrupted=false;public static $SHOW=array("d"=>true,"e"=>true,"i"=>true);static private function add($code,$message){global $FIELD;if(message::$SHOW[$code]){array_push(php::$messages,collapse($FIELD,array($code,$message)));}}static public function D($message){message::add("d",$message);}static public function E($message){message::add("e",$message);}static public function I($message){message::add("i",$message);}static public function ARG($var,$value){message::add("a",$var,value);}static public function ARR($value){message::add("I",var_export($value));}static public function interrupt($message){if(!message::$interrupted){message::$interrupted=true;echo chr(7);}else{echo "~`";}echo "e~!".$message;}}function expand($level,$string){global $SPLIT;if($level<sizeof($SPLIT)-1){if((isset($string)&&$string=="")||$level>=sizeof($SPLIT)){return;}if($level==null){$level=0;}$string=explode($SPLIT[$level++],$string);for($index=0;$index<sizeof($string);$index++){$deepness=$level;if(strpos($string[$index],$SPLIT[$deepness])==-1){$deepness=checkForSplit($deepness,$string[$index]);}if($deepness<sizeof($SPLIT)){}}return $string;}}function checkForSplit($level,$string){for(;$level<sizeof($SPLIT);$level++){if(strpos($string,$SPLIT[$level])!=-1){break;}}return $level;}function collapse($level,$array){global $SPLIT;if($level<sizeof($SPLIT)-1){for($index=0;$index<sizeof($array);$index++){if(gettype($array[$index])=="array"){$array[$index]=collapse($level+1,$array[$index]);}}}return implode($SPLIT[$level],$array);}function respond($text){global $response;$response.=$text;}function respondl($text){respond($text."\n");}class User{public static $ID=0;public static $stat=array();public function __construct(){}public static function SessionFixation(){if(!isset($_SESSION['CREATED'])){$_SESSION['CREATED']=time();}else if(time()-$_SESSION['CREATED']>1800){session_regenerate_id(true);$_SESSION['CREATED']=time();}}public static function nameFromID($id){DB::tempTable("LOGIN");$user=DB::selectSingle(array("id"=>$id),"Username");DB::restoreTable();return $user["Username"];}public static function checkLoginRequired(){}public static function isLoggedIn(){if(User::$ID!=0){return true;}message::E("notLoggedIn");return false;}public static function getStats(){User::addStatTable("LOGIN");unset(User::$stat["password"]);User::addStatTable("USER");User::addStatTable("CNCT");}public static function addStatTable($table){if(User::$ID!=0){DB::tempTable($table);if($table=DB::selectSingle(array("id"=>User::$ID))){unset($table["id"]);User::$stat=array_merge(User::$stat,$table);}DB::restoreTable();}}public static function checkLogin(){global $language,$loginTimeout,$D;ob_start();session_start();php::setErrorHandler();if(isset($_SESSION["ID"])){User::login($_SESSION['ID'],$_SESSION["REMEMBERLOGIN"]);}else if(isset($_COOKIE['ID'])){User::login($_COOKIE['ID'],$_SESSION["REMEMBERLOGIN"]);}else{if(isset($_SESSION['LAST_ACTIVITY'])&&User::isExpired($_SESSION['LAST_ACTIVITY'],$loginTimeout*60)){session_destroy();session_unset();}$_SESSION['LAST_ACTIVITY']=time();User::SessionFixation();User::checkLoginRequired();}DB::tempTable("USER");if(isset($_SESSION["ID"])&&class_exists('DB')&&($user=DB::selectSingle(array("id"=>$_SESSION["ID"])))){$language=$user["language"];}else if(isset($_POST["language"])){$language=$_POST["language"];}else{$language=tBase();}DB::restoreTable();User::getStats();}public static function isExpired($expiry,$timeout){return time()-$expiry>$timeout;}public static function login($id,$remember){if(!is_numeric($id)){message::I("UserID Not An Int");return;}User::SessionFixation();session_regenerate_id();$_SESSION["ID"]=$id;User::$ID=$id;if($remember=='true'){$_SESSION["REMEMBERLOGIN"]=true;setcookie("ID",$_SESSION["ID"],time()+1209600000,'/');setcookie("Name",User::nameFromID($id),time()+1209600000,'/');}else{$_SESSION["REMEMBERLOGIN"]=false;}}public static function logout(){User::$ID=0;unset($_SESSION['ID']);unset($_COOKIE['ID']);}}function printArr($array,$name){foreach($array as $key=>$value){message::I($name."[".$key."]=".$value);}}function getIP(){return!filter_var(@$_SERVER["HTTP_CLIENT_IP"],FILTER_VALIDATE_IP)?(!filter_var(@$_SERVER["HTTP_X_FORWARDED_FOR"],FILTER_VALIDATE_IP)?$_SERVER["REMOTE_ADDR"]:$_SERVER["HTTP_X_FORWARDED_FOR"]):$_SERVER["HTTP_CLIENT_IP"];}function setLanguage($newLang){global $language,$text;if($language!=$newLang){$toFetch=array();foreach($text as $key=>$value){array_push($toFetch,$key);}$text=tGet(implode(",",$toFetch));$language=$newLang;}}function tBase(){$countryCode=@json_decode(file_get_contents("http://www.geoplugin.net/json.gp?ip=".getIP()))->geoplugin_countryCode;switch($countryCode){case "jp":return "jp";}return "en";}function tGet($fields){global $language,$text;DB::tempTable("TEXT");$fields=explode(",",$fields);$new=DB::selectFields(array("name"=>$fields),$language);for($index=0;$index<count($text);$index++){$text[$fields[$index]]=$new[$index];}DB::restoreTable();return $text;}function errorCode($code,$message){respond($code);if($message!=null){error($message);}PHP();}function error($message){message::e($message);PHP();}function saveImageFromOtherSite($url,$path){file_put_contents($_SERVER['DOCUMENT_ROOT']."/images/".$path,file_get_contents($url));}function PHP(){php::out();} ?>