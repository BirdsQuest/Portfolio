<!DOCTYPE html><html latestURL="https://randomcode.run/JapaneseTextOnCanvas" version="1.0" lang="en"><title>Japanese Text On Canvas</title><meta charset="utf-8"><link rel="icon" type="image/x-icon" href="images/favicon.ico"><script>const version="1.00",baseURL="randomcode.run",contactMail="mattbird@randomcode.run";function HEADER(name){console.log.apply(console,["\n%c\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\u00A0%c MADE WITH:"+("                                   v"+version).slice((version+"".length))+" %c\u00A0\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\n"+"%c\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\u00A0%c\u00A0\u2590\u2588\u2580\u2584\u00A0\u2584\u2580\u2580\u2584\u00A0\u2588\u2584\u00A0\u00A0\u2588\u2590\u2588\u2580\u2588\u00A0\u2584\u2580\u2580\u2584\u00A0\u2588\u2584\u00A0\u2584\u2588\u00A0\u2584\u2580\u2580\u2584\u00A0\u2584\u2580\u2580\u2584\u2590\u2588\u2580\u2588\u00A0\u2588\u2580\u2580\u00A0\u00A0%c\u00A0\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\n%c\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\u00A0%c\u00A0\u2590\u2588\u2584\u2580\u00A0\u2588\u2584\u2584\u2588\u00A0\u2588\u00A0\u2588\u00A0\u2588\u2590\u2588\u00A0\u2590\u258C\u2588\u00A0\u00A0\u2588\u00A0\u2588\u00A0\u2588\u00A0\u2588\u00A0\u2588\u00A0\u00A0\u00A0\u00A0\u2588\u00A0\u00A0\u2588\u2590\u2588\u00A0\u2590\u258C\u2588\u2580\u00A0\u00A0\u00A0%c\u00A0\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\n%c\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\u00A0%c\u00A0\u2590\u2588\u00A0\u2588\u00A0\u2588\u00A0\u00A0\u2588\u00A0\u2588\u00A0\u00A0\u2580\u2588\u2590\u2588\u2584\u2588\u00A0\u2580\u2584\u2584\u2580\u00A0\u2588\u00A0\u00A0\u00A0\u2588\u00A0\u2580\u2584\u2584\u2580\u00A0\u2580\u2584\u2584\u2580\u2590\u2588\u2584\u2588\u00A0\u2588\u2584\u2584\u00A0\u00A0%c\u00A0\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\n%c\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\u00A0%c https://"+baseURL+"/ | "+contactMail+" %c\u00A0\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\n%c\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\u00A0%c run(\""+name+"\");                                  ".slice(-10-name+"".length)+"%c\u00A0\u00A0\u00A0%c\u00A0\u00A0%c\u00A0\u00A0\n",...['background:#00e600','background:#009900','background:#006600','color:#ffffff;background:#003300','background: #006600','background: #009900','background: #00e600'],...['background:#00e600','background:#009900','background:#006600','color:#ffffff;background:#003300','background: #006600','background: #009900','background: #00e600'],...['background:#00e600','background:#009900','background:#006600','color:#ffffff;background:#003300','background: #006600','background: #009900','background: #00e600'],...['background:#00e600','background:#009900','background:#006600','color:#ffffff;background:#003300','background: #006600','background: #009900','background: #00e600'],...['background:#00e600','background:#009900','background:#006600','color:#ffffff;background:#003300','background: #006600','background: #009900','background: #00e600'],...['background:#00e600','background:#009900','background:#006600','color:#ffffff;background:#003300','background: #006600','background: #009900','background: #00e600']])};/*
randomcodode.run/
░░▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░
░░▒▒▓▓▓													 ▓▓▓▒▒░░
░░▒▒▓▓▓ ▐█▀▄ ▄▀▀▄ █▄  █▐█▀█ ▄▀▀▄ █▄ ▄█ ▄▀▀▄ ▄▀▀▄▐█▀█ █▀▀ ▓▓▓▒▒░░
░░▒▒▓▓▓ ▐█▄▀ █▄▄█ █ █ █▐█ ▐▌█  █ █ █ █ █    █  █▐█ ▐▌█▀  ▓▓▓▒▒░░
░░▒▒▓▓▓ ▐█ █ █  █ █  ▀█▐█▄█ ▀▄▄▀ █   █ ▀▄▄▀ ▀▄▄▀▐█▄█ █▄▄ ▓▓▓▒▒░░
░░▒▒▓▓▓ https://randomcode.run | mattbird@randomcode.run ▓▓▓▒▒░░
░░▒▒▓▓▓             	 JapaneseTextOnCanvas v1.0	 	   		     ▓▓▓▒▒░░
░░▒▒▓▓▓													 ▓▓▓▒▒░░
░░▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░
░░▒▒▓▓▓													 ▓▓▓▒▒░░
░░▒▒▓▓▓													 ▓▓▓▒▒░░
░░▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░*/</script>
<script>
var content;
const t=true,f=false,n=null,run={};
function onLoad(func){
	if(document.readyState==='complete'){func();}
	else{window.onload=((oldLoad,func)=>{
		return function(){
			oldLoad && oldLoad();
			func();
		}	})(window.onload,func);
}	}
onLoad(e=>{
	content=ACE(document.body,"main");
	var url = window.location.pathname,
			filename = url.substring(url.lastIndexOf('/')+1);
	filename=filename.substring(0,filename.lastIndexOf('.'));
	HEADER(filename);
	run[filename]();
});
function AE(element,parent=content){
	var origElement=element;
	if(parent instanceof DOMObj){parent.appendChild(element.DOM);}
	else if(isDefined(element.DOM)){
		while(element.DOM!=null){
			element=element.DOM;
		}
	}
	parent.appendChild(element);
	if("appended" in origElement){origElement.appended();}
	return origElement;
}
function ACE(parent=content){
	var args=ArgToArr(arguments);
	args.shift();
	var element=CE(...args);
	AE(element,parent);
	return element;
}
function CE(){
	var info=ArgToArr(arguments),type,element,fields;
	if(cElement.hasOwnProperty(info[0])){//Check that it's in the valid command list
		fields=cElement[info[0]];
	}else{
		fields=[info[0],"generic"];
	}
	element=document.createElement(fields[0]);
	if(["svg","polygon"].indexOf(fields[0])!=-1){element=document.createElementNS("http://www.w3.org/2000/svg",fields[0]);}
	if(fields[1]=="generic"){fields=cElement["generic"];}
	else if(fields[1]=="func"){return cElement[info[0]][2](...info);}
	else if(fields[0]=="domobj"){return new fields[1](...info.shift());}
	for(let index=1;index<fields.length;index++){
		if(fields[index]=="set"){element[fields[++index]]=fields[++index];}
		else if(info[index]==null){}
		else if(fields[index]=="content"){
			if(info[index]!=null){
				if(info[index] instanceof Array){
					for(let innerdex=0;innerdex<info[index].length;innerdex++){
						if(typeof info[index][innerdex]=="string"){info[index][innerdex]=document.createTextNode(info[index][innerdex]);}
						AE(info[index][innerdex],element);
					}
				}else{element.innerText=info[index];}
		}	}
		else if(fields[index]=="keySet"){forIn(info[index],(key,value)=>{element.setAttribute(key,value);});}
		else if(fields[index]=="rt"){element.appendChild(CE("rt",info[index]))}
		else if(fields[index]=="points"){element.setAttribute(fields[index],info[index]);}
		else if(["onclick"].indexOf(fields[index])!=-1){element.addEventListener("click",info[index]);}
		else if(["innerText"].indexOf(fields[index])!=-1){element[fields[index]]=info[index];}
		else if(info[index]!=null){element.setAttribute(fields[index],info[index]);}
	}
	return element;
}
function addCE(){
	let args=ArgsToArr(arguments);
	cElement[args.pop()]=args;
}
const cElement={
		"favico":["favicon","func",(type,src,firstScriptTag=document.getElementsByTagName('script')[0])=>{
			let element=CE("link");
			element.setAttribute("rel","shortcut icon");
			element.setAttribute("type","image/x-icon");
			element.setAttribute("title","favIcon");
			element.setAttribute("href",src);
			firstScriptTag.parentNode.insertBefore(element, firstScriptTag);
			return element;
	}],
		'btn':["input","value","id","class","onclick","set","type","button"],//Button

	'ipt':["input","value","name","class","type","keySet"],//Input

	'txtArea':["textarea","content","name","class","placeholder","cols","rows","wrap"],//Text Area  wrap="hard"||"soft"
	'cvs':["canvas","id","class","onclick","left","top","width","height"],//Canvas

	'generic':["","content","id","class","onclick","keySet"]
};
function br(parent=content){return ACE(parent,"br");}

class DOMObj{
	constructor(parent){
		var fields=ArgToArr(arguments);
		if(fields[0] instanceof ExtendedObj){
			fields[0].expand(this);
			fields.shift();
		}
		for(let index=0;index<fields.length;index++){
			this[fields[index++]]=fields[index];
		}
		this.DOM=CE("div");
		if(isDefined(this.preGen)){this.preGen();}
		this.boundEvents={};
		let keywords=[
	    	//Keyboard Events
	    	["keyUp","keyup"],["keyDown","keydown"],
	    	//Mouse Events
	    	["onClick","click"],["mouseUp","mouseup"],["hover","mousemove"],["mouseDown","mousedown"],["mouseOut","mouseout"],["mouseIn","mouseenter"],["contextMenu","contextmenu"],
	    	//Element Events
	    	["onBlur","focusout"],["onFocus","onfocus"],["onChange","change"],
	    	//Drag/Drop Events
		    ["drag","drag"],["dragStart","dragstart"],["dragEnd","dragend"],["dragOn","dragenter"],["dragOff","dragleave"],["dragOver","dragover"],["drop","drop"]
		
		];

		this.generate();
		
		for(let id=0; id<keywords.length;id++){
			if(this[keywords[id][0]]!=null){this.addListener(keywords[id][1],this[keywords[id][0]]);}
		}
		if(isDefined(this.postGen)){this.postGen();}
	}
	addListener(listener,func,DOM=this.DOM){
		if(this.boundEvents.hasOwnProperty(listener)){this.removeListener(listener,DOM);}
		this.boundEvents[listener]=func.bind(this);
		DOM.addEventListener(listener,this.boundEvents[listener],false);
	}
	shareVars(){
		let args=ArgToArr(arguments).map((arg)=>{
			if(isFunc(this[arg])){
				return obj=>{obj[arg]=this[arg].bind(this)}
			}else{
				return (obj)=>{Object.defineProperty(obj, arg,{get:(()=>{return this[arg]}).bind(this),set:((data)=>{this[arg]=data;}).bind(this)})};
			}
		});
		return args;
	}
	set sharedVars(args){args.map(a=>a(this));}
	removeListener(listener,DOM=this.DOM){
		try{DOM.removeEventListener(listener,this.boundEvents[listener]);
			delete this.boundEvents[listener];
		}catch(e){}
	}
	preventDefault(e){
		if(e.preventDefault){e.preventDefault();}
		if(e.stopPropagation){e.stopPropagation();}
	}
	generate(parent){return null;}
	insertChild(parent,index){
		var DOM=this;
		while(DOM instanceof DOMObj){DOM=DOM.DOM;}
		while(parent.DOM!=null){parent=parent.DOM;}
		if(index>=parent.children.length){AE(DOM,parent);}
		else{parent.insertBefore(DOM, parent.children[index].nextSibling);}
	}
	insertAfter(element){
		var DOM=this;
		while(DOM instanceof DOMObj){DOM=DOM.DOM;}
		while(!isDOM(element)){element=element.DOM;}
			element.parentNode.insertBefore(DOM, element.nextSibling);
	}
	appendChild(object){
		while(object.DOM!=null){object=object.DOM;}
		this.DOM.appendChild(object);
	}
	removeChild(object){this.DOM.removeChild(object);}
	remove(){
		if(this.parentNode!=null){
			var object=this.DOM;
			while(object!=null&&object instanceof DOMObj){object=object.DOM;}
			this.parentNode.removeChild(object);
	}	}
	toggleCSS(rule,DOM=this.DOM){
		if(!DOM.classList.contains(rule)){
			DOM.classList.add(rule);
		}else{
			DOM.classList.remove(rule);
		}
	}
	overlaps(elem){
		return !((this.bottom < elem.top) ||
						(this.top > elem.bottom) ||
						(this.right < elem.left) ||
						(this.left > elem.right))
	}
	setProperty(name,getter,setter){
		let property={};
		if(getter!=null){property.get=getter;}
		if(setter!=null){property.set=setter;}
		Object.defineProperty(this,name,property);
	}
	get height(){return this.DOM.offsetHeight;}
	get width(){return this.DOM.offsetWidth;}
	set width(width){if(width!=null){this.DOM.style.width=width+"px";}}
	set height(height){if(height!=null){this.DOM.style.height=height+"px";}}
	get top(){return this.DOM.offsetTop;}
	get classList(){return this.DOM.classList;}
	get left(){return this.DOM.offsetLeft;}
	get right(){return this.left+this.width;}
	get bottom(){return this.top+this.height;}
	get innerHTML(){return this.DOM.innerHtml;}
	set hidden(hidden){
		if(hidden&&!this.DOM.classList.contains("hidden")){
			this.DOM.classList.add("hidden");
		}else if(!hidden&&this.DOM.classList.contains("hidden")){
			this.DOM.classList.remove("hidden");
		}
	}
	get innerText(){return this.DOM.innerText;}
	set innerText(text){this.DOM.innerText=text;}
	get className(){return this.DOM.className;}
	set className(className){this.DOM.className=className;}
	get childNodes(){return this.DOM.childNodes;}
	get children(){return this.DOM.children;}
	clearChildren(){
		this.DOM.innerHTML="";
	}
	get parentNode(){
		var node=this.DOM;
		while(node.DOM!=null){node=node.DOM;}
		return node.parentNode;
	}
	replaceDOM(object){
		while(object.DOM!=null){object=object.DOM;}
		var index=Array.from(this.parentNode.children).indexOf(this.DOM);//only available from Chrome 45 and Firefox 32, and not available on Internet Explorer
		this.parentNode.replaceChild(object, this.parentNode.childNodes[index]);
		this.DOM=object;
	}
}
class ExtendedObj extends DOMObj{
	constructor(args){super("args",args);}
	expand(object){
		for(let index=0;index<this.args.length;index++){
			object[this.args[index++]]=this.args[index];
		}
	}
}
function ArgToArr(arg){return Array.prototype.slice.call(arg);}
function forIn(object,callback){for(let key in object){callback(key,object[key]);}}

function isDefined(object){return typeof object!='undefined';}

class Obj{
	constructor(){
		var fields=ArgToArr(arguments);
		if(fields[0] instanceof ExtendedObj){
			fields[0].expand(this);
			fields.shift();
		}
		for(let index=0;index<fields.length;index++){
			this[fields[index++]]=fields[index];
		}
	}
	static null(){
		var object=new Obj(), fields=arguments;
		for(let index=0;index<fields.length;index++){
			object[fields[index]]=null;
		}
		return object;
	}
	static extendable(variableCount,args){
		return new ExtendedObj(ArgToArr(args).slice(variableCount));
	}
	shareVars(){
		let args=ArgToArr(arguments).map((arg)=>{
			if(isFunc(this[arg])){
				return (obj)=>{obj[arg]=this[arg].bind(this);}
			}else{
				return (obj)=>{Object.defineProperty(obj, arg,{get:(()=>{return this[arg]}).bind(this),set:((data)=>{this[arg]=data;}).bind(this)})};
			}
		});
		return args;
	}
	set sharedVars(args){args.map(a=>a(this));}
	setProperty(name,getter,setter){
		let property={};
		if(getter!=null){property.get=getter;}
		if(setter!=null){property.set=setter;}
		Object.defineProperty(this,name,property);
	}
}
class SimpleLoader extends Obj{
	constructor(finishedLoading,items){super("finishedLoading",finishedLoading,"items",items||0);}
	addItem(){this.items++;}
	addItems(ammount=0){this.items+=ammount;}
	removeItem(){this.items--;this.checkLoader();}
	checkLoader(){
		//console.log("Item count is",this.items);
		if(this.items!=0){
			this.load();
		}else if(this.finishedLoading!=null){this.finishedLoading();}
	}
	load(){
	//	this.timeout=setTimeout((()=>{
		//	log.arg("this.items",this.items);
		//console.log("Item count is",this.items);
			if(this.items==0){
				this.finishedLoading();}
		//}).bind(this),100);
	}
}
function isArray(array){return array instanceof Array;}
function hasKey(object,key){return object.hasOwnProperty(key);}
</script>
<script>//JapaneseTextOnCanvas
run.japaneseTextOnCanvas=e=>demoJPTxtToCvs();

function demoJPTxtToCvs(){
	let text="[日,に][本,ほん][語,ご]の[言,ことば][葉,ば]";
	let ctx=CE("cvs",n,n,n,0,0,800,600).getContext("2d");
	AE(ctx.canvas);
	let fontSize=60;
	let textWidth=jpTxtToCvsWidth(ctx,text,fontSize);
	let x=(800-textWidth)/2;
	let y=600-fontSize*2;
	
	jpTxtToCvs(ctx,text,fontSize,x,y);
}

function jpTxtToCvsWidth(ctx,text="",fontSize=30,x=0,y=0,multiplier=2){
	//Get the jp array
	let jp=[],width=0;
	for(let index=0;index<text.length;index++){
		if(text[index]=="["){
			let outdex=text.indexOf("]",index);
			if(index!=0){jp.push(text.substring(0,index));}
			jp.push(text.substring(index+1,outdex).split(","));
			text=text.substring(outdex+1);
			index=-1;
	}	}
	if(text.length>0){jp.push(text);}
	
	//Make functions
	let setFontSize=(isFurigana=false)=>{ctx.font=(fontSize/(isFurigana?multiplier:1))+"px Arial";},
	getFuriganaWidth=(kana)=>{setFontSize(true);return ctx.measureText(kana).width;},
	getKanaWidth=(kana)=>{setFontSize();return ctx.measureText(kana).width;};
	
	//Get Widths
	jp.map((kana)=>{
		if(!isArray(kana)){width+=getKanaWidth(kana);}
		else{width+=Math.max(getKanaWidth(kana[0]),getFuriganaWidth(kana[1]));}
	});
	return width;
}

function jpTxtToCvs(ctx,text="",fontSize=30,x=0,y=0,multiplier=2){
	let kanaOffset=0;
	y+=fontSize/multiplier+fontSize/10;
	//Get the JP array
	let jp=[];
	for(let index=0;index<text.length;index++){
		if(text[index]=="["){
			let outdex=text.indexOf("]",index);
			if(index!=0){jp.push(text.substring(0,index));}
			jp.push(text.substring(index+1,outdex).split(","));
			text=text.substring(outdex+1);
			index=-1;
	}	}
	if(text.length>0){jp.push(text);}
	//Make functions
	let getFuriganaWidth=(kana)=>{
		setFontSize(true);
		return ctx.measureText(kana).width;
	},
	getKanaWidth=(kana)=>{
		setFontSize();
		return ctx.measureText(kana).width;
	},
	furiganaIsLonger=(kana)=>{
		return Math.ceil((getKanaWidth(kana[0])-getFuriganaWidth(kana[1]))/2);
	},
	setFontSize=(isFurigana=false)=>{
		ctx.font=(fontSize/(isFurigana?multiplier:1))+"px Arial";
	},
	writeKana=(kana,xOffset=0,isFurigana=false)=>{
		ctx.fillStyle='black';
    ctx.strokeStyle='white';
		setFontSize(isFurigana);
    ctx.lineWidth=fontSize/10;
		ctx.textBaseline=isFurigana?"bottom":"top";
		ctx.strokeText(kana,x+xOffset+kanaOffset,y);
		ctx.fillText(kana,x+xOffset+kanaOffset,y);
	};
	//Write it down
	jp.map((kana)=>{
			var wordWidth;
			let kanaXOffset=0;
			if(isArray(kana)){
				let furiganaXOffset=furiganaIsLonger(kana);
				if(furiganaXOffset<0){kanaXOffset=furiganaXOffset*-1;furiganaXOffset=0;}
				writeKana(kana[0],kanaXOffset);
				writeKana(kana[1],furiganaXOffset,true);
				kana=kana[0];
			}else{writeKana(kana);}
			kanaOffset+=getKanaWidth(kana)+kanaXOffset*2;;
		});
}

class CVSJPText extends DOMObj{
	constructor(text,x,y,fontSize,ctx){super("x",x||0,"y",y||0,"ctx",ctx||CE("cvs",n,n,n,0,0,800,600).getContext("2d"),"text",text||"","fontSize",fontSize||60,"kanaOffset",0,"multiplier",2);}
	generate(){
		this.y+=this.fontSize/this.multiplier+this.fontSize/10;
		AE(this.canvas,this.DOM);
		AE(this.textToJP(this.text),this.DOM);
		this.clearCanvas();
		let jp=CVSJPText.jpArray(this.text);
		jp.map((word)=>{
			var wordWidth;
			if(isArray(word)){let kanaXOffset=0;
				let furiganaXOffset=this.furiganaIsLonger(word);
				if(furiganaXOffset<0){
					kanaXOffset=furiganaXOffset*-1;
					furiganaXOffset=0;
				}
				
				this.writeKana(word[0],kanaXOffset);
				wordWidth=this.ctx.measureText(word[0]).width+kanaXOffset*2;
				this.writeFurigana(word[1],wordWidth);
			}else{
				this.writeKana(word);
				wordWidth=this.ctx.measureText(word).width;
			}
			this.kanaOffset+=wordWidth;
		});
	}
	jpTextToCVS(cvs,text,fontSize,x,y,width,height,furiganaScale){
		
	}
	get canvas(){return this.ctx.canvas;}
	clearCanvas(){
		
		this.ctx.beginPath();
		this.ctx.fillStyle='black';
		this.ctx.rect(0,0,800,600);
		this.ctx.fill();
	}
	static getTextWidth(ctx,jp,fontSize=30){
		jp=CVSJPText.jpArray(jp),width=0;
		jp.map((kana)=>{
			if(isArray(kana)){
				width+=Math.max(CVSJPText.getKanaWidth(ctx,kana[0],fontSize),CVSJPText.getFuriganaWidth(ctx,kana[0],fontSize,2));
			}
			else{width+=CVSJPText.getKanaWidth(ctx,kana,fontSize);}
		});
		return width;
	}
	static getFuriganaWidth(ctx,text,fontSize,multiplier){
		ctx.font=(fontSize/multiplier)+"px Arial";
		return ctx.measureText(text).width;
	}
	static getKanaWidth(ctx,text,fontSize){
		ctx.font=fontSize+"px Arial";
		return ctx.measureText(text).width;
	}
	furiganaIsLonger(text){
		return Math.ceil((CVSJPText.getKanaWidth(this.ctx,text[0],this.fontSize)-CVSJPText.getFuriganaWidth(this.ctx,text[1],this.fontSize,this.multiplier))/2);
	}
	writeFurigana(text,kanaWidth=0){
		this.ctx.textBaseline='bottom';
		this.ctx.fillStyle='black';
    this.ctx.strokeStyle='white';
    this.ctx.lineWidth=this.fontSize/10;
    this.ctx.font=(this.fontSize/this.multiplier)+"px Arial";
		let x=this.x;
		x+=(kanaWidth-CVSJPText.getFuriganaWidth(this.ctx,text,this.fontSize,this.multiplier))/2+this.kanaOffset;
		this.ctx.strokeText(text, x,this.y);
		this.ctx.fillText(text,x,this.y);
	}
	writeKana(text,xOffset=0){
		this.ctx.textBaseline='top';
		this.ctx.fillStyle='black';
    this.ctx.strokeStyle='white';
    this.ctx.lineWidth=this.fontSize/10;
		this.ctx.font=this.fontSize+"px Arial";
		this.ctx.strokeText(text,this.x+xOffset+this.kanaOffset,this.y);
		this.ctx.fillText(text,this.x+xOffset+this.kanaOffset,this.y);
	}
	static jpArray(text){
		let jp=[];
		for(let index=0;index<text.length;index++){
			if(text[index]=="["){//itterate text for open square bracket
				let outdex=text.indexOf("]",index);//Scan to closing bracket
				if(index!=0){jp.push(text.substring(0,index));}//if there's anything before the bracket, add it
				jp.push(text.substring(index+1,outdex).split(","));//isolate outdex the brackets and split the comma
				text=text.substring(outdex+1);//Set text to the remaining text
				index=-1;//reset the index
		}	}
		if(text.length>0){jp.push(text);}
		return jp;
	}
	textToJP(text,fontSize){
		let jp=CVSJPText.jpArray(text);
		jp=CE("jp",jp);
		if(fontSize!=n){jp.style.fontSize=fontSize+"px";}
		return jp;
	}
}
</script><!-- JapaneseTextOnCanvas -->